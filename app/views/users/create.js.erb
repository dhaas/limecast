<% if @user.new_record? -%>
  <% if @user.errors[:email] -%>
    <% if @user.errors[:email].include?("has already been taken") -%>
      <p>This email is already signed up! <%= link_to "I forgot my password", forgot_password_url -%></p>
    <% elsif @user.errors[:email].include?("can't be blank") or @user.errors[:email].include?("is invalid") -%>
      <p>Please type your email address</p>
    <% else -%>
      <pre><%= @user.errors.to_yaml -%></pre>
    <% end -%>
  <% elsif @user.errors[:login] -%>
    <% if @user.errors[:login].include?("is invalid") or @user.errors[:login].include?("cannot be blank") -%>
      <p>Choose your new user name</p>
    <% elsif @user.errors[:login].include?("is too short (minimum is 3 characters)") -%>
      <p>User names must be at least 3 characters</p>
    <% elsif @user.errors[:login].include?("has already been taken") -%>
      <p>Sorry, this name is taken.  Please pick another one.</p>
    <% else -%>
      <pre><%= @user.errors.to_yaml -%></pre>
    <% end -%>
  <% elsif @user.errors[:password] -%>
    <% if @user.errors[:password].include?("can't be blank") -%>
      <p>Please choose a password</p>
    <% elsif @user.errors[:password].include?("is too short (minimum is 3 characters)") -%>
      <p>Please choose a valid password</p>
    <% end -%>
  <% else -%>
    <pre><%= @user.errors.to_yaml -%></pre>
  <% end -%>
<% else -%>
  <script type="text/javascript">
    if($('quick_signin').visible()) {
      $('quick_signin').fade({ afterFinish: function() { window.location.reload() } });
    } else {
      if($('inline_login')) { $('inline_login').hide(); }
      $$('#account_bar .signup')[0].update('<%= link_to_profile current_user -%>');
    }
  </script>
<% end -%>
